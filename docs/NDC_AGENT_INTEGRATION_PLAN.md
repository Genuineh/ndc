# NDC AI Agent ç³»ç»Ÿé›†æˆåˆ†æä¸è°ƒæ•´è®¡åˆ’

> **æ—¥æœŸ**: 2026-02-11
> **ç›®çš„**: æ˜ç¡® NDC ç°æœ‰èƒ½åŠ›ä¸ OpenCode Agent æ¨¡å¼çš„å¯¹æ¥æ–¹å¼

---

## ä¸€ã€æ¶æ„å¯¹æ¯”åˆ†æ

### 1.1 OpenCode Agent æ ¸å¿ƒæ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        OpenCode Agent Architecture                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ç”¨æˆ·è¾“å…¥                                                                     â”‚
â”‚     â†“                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Agent é…ç½®ç³»ç»Ÿ                                â”‚    â”‚
â”‚  â”‚  - mode: subagent/primary/all                                    â”‚    â”‚
â”‚  â”‚  - permission: allow/ask/deny è§„åˆ™                                â”‚    â”‚
â”‚  â”‚  - temperature, topP, steps é…ç½®                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â†“                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    System Prompt                                â”‚    â”‚
â”‚  â”‚  - åˆ†å±‚æç¤ºè¯ (anthropic-20250930.txt, plan.txt, etc.)              â”‚    â”‚
â”‚  â”‚  - ä¸“é—¨çš„ explore/plan/generate æç¤ºè¯                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â†“                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LLM Provider                                  â”‚    â”‚
â”‚  â”‚  - æµå¼å“åº”                                                              â”‚    â”‚
â”‚  â”‚  - å·¥å…·è°ƒç”¨ (Tool Calling)                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â†“                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Tool Registry                                  â”‚    â”‚
â”‚  â”‚  - å·¥å…·å®šä¹‰ (define<T, M>)                                          â”‚    â”‚
â”‚  â”‚  - æƒé™æ£€æŸ¥ (PermissionNext.ask)                                   â”‚    â”‚
â”‚  â”‚  - è¾“å‡ºæˆªæ–­ (Truncate)                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â†“                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Skills System                                  â”‚    â”‚
â”‚  â”‚  - SKILL.md å®šä¹‰ (frontmatter + body)                            â”‚    â”‚
â”‚  â”‚  - å‚æ•°åŒ–æ¨¡æ¿æ‰§è¡Œ                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚     â†“                                                                       â”‚
â”‚  å“åº” + éªŒè¯                                                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 NDC ç°æœ‰ç³»ç»Ÿèƒ½åŠ›

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NDC ç°æœ‰ç³»ç»Ÿæ¶æ„                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   P1-P5 å·¥å…·ç³»ç»Ÿ      â”‚    â”‚    P6 LLM é›†æˆå±‚                      â”‚    â”‚
â”‚  â”‚                     â”‚    â”‚                                      â”‚    â”‚
â”‚  â”‚ - Tool Registry     â”‚    â”‚ - Knowledge Understanding Service      â”‚    â”‚
â”‚  â”‚ - JSON Schema       â”‚    â”‚ - TODO Mapping Service              â”‚    â”‚
â”‚  â”‚ - Permission System â”‚    â”‚ - Decomposition Lint                 â”‚    â”‚
â”‚  â”‚ - Output Truncation  â”‚    â”‚ - Model Selector                      â”‚    â”‚
â”‚  â”‚                     â”‚    â”‚                                      â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚ â”‚  æ ¸å¿ƒå·¥å…·         â”‚ â”‚    â”‚ â”‚  LLM Provider                â”‚   â”‚    â”‚
â”‚  â”‚ â”‚  - read/write/editâ”‚ â”‚    â”‚ â”‚  - OpenAI/Anthropic/MiniMax   â”‚   â”‚    â”‚
â”‚  â”‚ â”‚  - grep/glob     â”‚ â”‚    â”‚ â”‚  - OpenRouter/Ollama          â”‚   â”‚    â”‚
â”‚  â”‚ â”‚  - bash          â”‚ â”‚    â”‚ â”‚  - Streaming                   â”‚   â”‚    â”‚
â”‚  â”‚ â”‚  - git           â”‚ â”‚ â”‚    â”‚  - Token Counter               â”‚   â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   P5 æ‰©å±•ç³»ç»Ÿ        â”‚    â”‚    P2-P3 è®¤çŸ¥ç³»ç»Ÿ                     â”‚    â”‚
â”‚  â”‚                     â”‚    â”‚                                      â”‚    â”‚
â”‚  â”‚ - MCP Manager       â”‚    â”‚ - Working Memory (ä¸Šä¸‹æ–‡ç®¡ç†)         â”‚    â”‚
â”‚  â”‚ - Skills Registry  â”‚    â”‚ - Invariant Gold Memory (æ°¸ä¸çŠ¯é”™)   â”‚    â”‚
â”‚  â”‚ - Tool Transport   â”‚    â”‚ - Task Lineage (è°±ç³»ç»§æ‰¿)          â”‚    â”‚
â”‚  â”‚                     â”‚    â”‚ - Failure Taxonomy (å¤±è´¥åˆ†ç±»)       â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚ â”‚ å¤–éƒ¨ MCP æœåŠ¡    â”‚ â”‚    â”‚ â”‚ Memory System                 â”‚   â”‚    â”‚
â”‚  â”‚ â”‚ - filesystem     â”‚ â”‚    â”‚ â”‚  - çŸ¥è¯†åº“æ£€ç´¢                 â”‚   â”‚    â”‚
â”‚  â”‚ â”‚ - github         â”‚ â”‚    â”‚ â”‚  - å·¥ä½œè®°å¿†                   â”‚   â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Runtime æ‰§è¡Œå¼•æ“                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ Event-Driven Engine (äº‹ä»¶é©±åŠ¨)                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Discovery Phase (å½±å­æ¢æµ‹ - P1)                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Saga Pattern (å¯å›æ»šæ‰§è¡Œ - P2)                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Quality Gates (è´¨é‡é—¨ç¦)                                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ Task Executor (ä»»åŠ¡æ‰§è¡Œå™¨)                                   â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€èƒ½åŠ›æ˜ å°„ä¸å¯¹æ¥æ–¹æ¡ˆ

### 2.1 æ ¸å¿ƒæ¦‚å¿µæ˜ å°„

| OpenCode æ¦‚å¿µ | NDC å¯¹åº”/å¢å¼ºæ–¹æ¡ˆ | è¯´æ˜ |
|----------------|------------------|------|
| **Agent (subagent/primary/all)** | NDC AgentRole + Agent Orchestrator | NDC å·²æœ‰ Planner/Implementer/Reviewer/Tester è§’è‰²ï¼Œå¯æ˜ å°„ä¸ºä¸åŒçš„ Agent æ¨¡å¼ |
| **Permission (allow/ask/deny)** | Permission System + Danger Level | NDC å·²å®ç° PermissionSystemï¼Œæ”¯æŒ allow/ask/deny |
| **Tool Registry** | ToolRegistry + Tool trait | å®Œå…¨å…¼å®¹ï¼Œç›´æ¥å¤ç”¨ |
| **Tool Schema** | ToolSchemaBuilder | å®Œå…¨å…¼å®¹ï¼Œå·²å®ç° |
| **Truncate** | OutputTruncator | å·²å®ç°ï¼Œç›´æ¥å¤ç”¨ |
| **Skills** | Skills Registry + SkillExecutor | å·²å®ç°ï¼Œéœ€è¦é›†æˆåˆ° Agent å·¥å…·åˆ—è¡¨ |
| **MCP** | MCP Manager + Transport | å·²å®ç°ï¼Œéœ€è¦è½¬æ¢ä¸º Agent å¯è°ƒç”¨å·¥å…· |
| **System Prompt** | PromptBuilder + å¤šå±‚æç¤ºè¯ | éœ€è¦åŸºäº NDC å·¥ç¨‹æ–¹æ³•é‡æ–°è®¾è®¡ |
| **Doom Loop Detection** | TaskVerifier + é‡è¯•æœºåˆ¶ | éœ€è¦é›†æˆåˆ° Agent Orchestrator |

### 2.2 æ¶æ„é›†æˆæ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   NDC Agent Orchestrator (æ–°å¢)                             â”‚
â”‚                                                                             â”‚
â”‚  èŒè´£: LLM äº¤äº’ä¸­å¤®æ§åˆ¶å™¨                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  â€¢ ä½¿ç”¨ OpenCode çš„æµå¼å“åº”æ¨¡å¼                                           â”‚
â”‚  â€¢ ä½¿ç”¨ OpenCode çš„æƒé™ç¡®è®¤æ¨¡å¼                                          â”‚
â”‚  â€¢ å¢å¼ºå†…ç½® NDC å·¥ç¨‹èƒ½åŠ›                                                   â”‚
â”‚  â€¢ é›†æˆ NDC åé¦ˆå¾ªç¯éªŒè¯                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å·¥å…·é€‚é…å±‚ (Tool Adapter Layer)       â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚ MCP â†’ NDC Tool Wrapper         â”‚ â”‚
                    â”‚  â”‚ Skills â†’ NDC Tool Wrapper      â”‚ â”‚
                    â”‚  â”‚ Internal NDC Tools             â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  çŸ¥è¯†å¢å¼ºå±‚ (Knowledge Layer)         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚ Working Memory æ³¨å…¥            â”‚ â”‚
                    â”‚  â”‚ Invariant Gold Memory æ³¨å…¥      â”‚ â”‚
                    â”‚  â”‚ TODO Mapping Service           â”‚ â”‚
                    â”‚  â”‚ Knowledge Base æ£€ç´¢             â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  NDC Runtime Layer                    â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚ P1-P5 Tools (read/write/edit...) â”‚ â”‚
                    â”‚  â”‚ MCP External Tools              â”‚ â”‚
                    â”‚  â”‚ Skills System                   â”‚ â”‚
                    â”‚  â”‚ Discovery Phase                 â”‚ â”‚
                    â”‚  â”‚ Quality Gates                    â”‚ â”‚
                    â”‚  â”‚ Saga Executor                   â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€NDC å¢å¼ºæ–¹æ¡ˆ (Engineering Approach)

### 3.1 åé¦ˆå¾ªç¯å¢å¼º (è¶…è¶Š OpenCode)

OpenCode åŸºç¡€:
- AI æ‰§è¡Œ â†’ æäº¤ â†’ ç”¨æˆ·ç¡®è®¤ â†’ å®Œæˆ

NDC å¢å¼º:
```
AI æ‰§è¡Œ
    â†“
TaskVerifier (ç³»ç»ŸéªŒè¯)
    â”œâ”€ æ£€æŸ¥ä»»åŠ¡çŠ¶æ€
    â”œâ”€ éªŒè¯æ‰§è¡Œæ­¥éª¤
    â”œâ”€ è¿è¡Œè´¨é‡é—¨ç¦
    â””â”€ æ£€æŸ¥ Git æäº¤
    â†“
éªŒè¯ç»“æœ
    â”œâ”€ Completed â†’ æˆåŠŸ
    â”œâ”€ Incomplete â†’ ç”Ÿæˆç»§ç»­æŒ‡ä»¤ â†’ AI ç»§ç»­
    â””â”€ QualityGateFailed â†’ è¿è¡Œæµ‹è¯•ä¿®å¤ â†’ AI ç»§ç»­
    â†“
Invariant è®°å½• (Human Correction â†’ Gold Memory)
    â†“
å®Œæˆ
```

### 3.2 Working Memory æ³¨å…¥

å°† NDC çš„ WorkingMemory ä½œä¸ºç³»ç»Ÿæç¤ºè¯çš„ä¸€éƒ¨åˆ†æ³¨å…¥ï¼š

```rust
// æ„å»º Agent ç³»ç»Ÿæç¤ºè¯
fn build_agent_system_prompt(ctx: &AgentContext) -> String {
    let mut prompt = base_system_prompt();

    // æ³¨å…¥ Working Memory
    if let Some(wm) = &ctx.working_memory {
        prompt.push_str(&format!("\n## Current Working Context\n\n"));
        prompt.push_str(&format!("Active Files:\n"));
        for file in &wm.active_files {
            prompt.push_str(&format!("  - {}\n", file));
        }

        if !wm.recent_failures.is_empty() {
            prompt.push_str(&format!("\nRecent Failures:\n"));
            for failure in &wm.recent_failures {
                prompt.push_str(&format!("  - {}\n", failure.description));
            }
        }

        if !wm.invariants.is_empty() {
            prompt.push_str(&format!("\nImportant Invariants:\n"));
            for inv in &wm.invariants {
                prompt.push_str(&format!("  - {}\n", inv.constraint));
            }
        }
    }

    prompt
}
```

### 3.3 Phase 0: è°±ç³»ç»§æ‰¿å¢å¼º

OpenCode æ²¡æœ‰ä»»åŠ¡è°±ç³»æ¦‚å¿µï¼ŒNDC å¯ä»¥å¢å¼ºï¼š

```rust
// æ„å»º Agent è¯·æ±‚æ—¶æ³¨å…¥ Task Lineage
async fn build_agent_request(
    orchestrator: &AgentOrchestrator,
    task_id: Option<TaskId>,
) -> AgentRequest {
    let mut prompt = "User request: ".to_string();

    if let Some(task_id) = task_id {
        // è·å–ä»»åŠ¡è°±ç³»
        let lineage = task_lineage.get_lineage(task_id).await;

        // çˆ¶ä»»åŠ¡çš„ä¸å˜é‡æ³¨å…¥
        for invariant in &lineage.inherited_invariants {
            prompt.push_str(&format!(
                "\n## Constraint (from parent task)\n{}\n",
                invariant.constraint
            ));
        }

        // çˆ¶ä»»åŠ¡çš„å†å²å¤±è´¥æ¨¡å¼
        for pattern in &lineage.inherited_failures {
            prompt.push_str(&format!(
                "\n## Avoid (previous failure)\n{}\n",
                pattern.description
            ));
        }
    }

    // ...
}
```

### 3.4 Skills ä½œä¸ºå·¥å…·

å°† NDC Skills ç³»ç»Ÿç›´æ¥æš´éœ²ä¸º Agent å¯è°ƒç”¨å·¥å…·ï¼š

```rust
// ä» Skill è½¬æ¢ä¸º Tool
impl Tool for SkillAdapter {
    fn name(&self) -> &str {
        &self.skill.name
    }

    fn description(&self) -> &str {
        &self.skill.description
    }

    fn schema(&self) -> serde_json::Value {
        // Skill å‚æ•°è½¬æ¢ä¸º JSON Schema
        let mut properties = Map::new();

        for param in &self.skill.parameters {
            properties.insert(
                param.name.clone(),
                json!({
                    "type": param.r#type,
                    "description": param.description
                })
            );
        }

        json!({
            "type": "object",
            "properties": properties,
            "required": self.skill.parameters.iter()
                .filter(|p| p.required)
                .map(|p| p.name.clone())
                .collect::<Vec<_>>()
        })
    }

    async fn execute(&self, params: &ToolParams) -> ToolResult {
        // ä½¿ç”¨ SkillExecutor æ‰§è¡Œ
        let executor = SkillExecutor::new(/* ... */);

        let context = SkillExecutionContext {
            skill: &self.skill,
            parameters: params.clone(),
            working_dir: std::env::current_dir().unwrap(),
        };

        match executor.execute(&context).await {
            Ok(result) => ToolResult {
                success: result.success,
                output: result.output,
                error: result.error,
                metadata: ToolMetadata::default(),
            },
            Err(e) => ToolResult {
                success: false,
                output: String::new(),
                error: Some(e.to_string()),
                metadata: ToolMetadata::default(),
            }
        }
    }
}
```

### 3.5 MCP å·¥å…·åŠ¨æ€åŠ è½½

å°† MCP å‘ç°çš„å·¥å…·è‡ªåŠ¨æ³¨å†Œä¸º Agent å·¥å…·ï¼š

```rust
// MCP Tool Adapter
pub struct McpToolAdapter {
    server_name: String,
    tool: McpTool,
    client: McpClient,
}

impl Tool for McpToolAdapter {
    fn name(&self) -> &str {
        &format!("{}_{}", self.server_name, self.tool.name)
    }

    fn description(&self) -> &str {
        &self.tool.description
    }

    fn schema(&self) -> serde_json::Value {
        self.tool.input_schema.clone()
    }

    async fn execute(&self, params: &ToolParams) -> ToolResult {
        // è°ƒç”¨ MCP å·¥å…·
        let result = self.client.call_tool(
            &self.tool.name,
            serde_json::from_value(params.clone()).unwrap()
        ).await?;

        ToolResult {
            success: !result.is_error,
            output: result.content,
            error: if result.is_error { Some(result.tool_name) } else { None },
            metadata: ToolMetadata::default(),
        }
    }
}
```

---

## å››ã€å¼€å‘è®¡åˆ’è°ƒæ•´

### Phase 1: å·¥å…·é›†æˆå±‚ (P7.1)

**ç›®æ ‡**: å°† NDC ç°æœ‰å·¥å…·ç³»ç»Ÿæ— ç¼é›†æˆåˆ° Agent

**ä»»åŠ¡**:
- [ ] å®ç° `ToolExecutor` traitï¼Œæ¡¥æ¥ Agent Orchestrator å’Œ Tool Manager
- [ ] å®ç° MCP Tool Adapterï¼Œå°† MCP å·¥å…·è½¬æ¢ä¸º Agent å·¥å…·
- [ ] å®ç° Skill Tool Adapterï¼Œå°† Skills è½¬æ¢ä¸º Agent å·¥å…·
- [ ] å®ç°å·¥å…·æ³¨å†Œè¡¨çš„åŠ¨æ€æ›´æ–° (MCP/Skills åŠ è½½æ—¶)

**æ–‡ä»¶**:
```
crates/core/src/ai_agent/
â”œâ”€â”€ tool_executor.rs        # ToolExecutor trait å®ç°
â”œâ”€â”€ adapters/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ mcp_adapter.rs       # MCP â†’ NDC Tool
â”‚   â””â”€â”€ skill_adapter.rs     # Skill â†’ NDC Tool
```

### Phase 2: çŸ¥è¯†æ³¨å…¥ç³»ç»Ÿ (P7.2)

**ç›®æ ‡**: å°† NDC è®¤çŸ¥ç³»ç»Ÿæ³¨å…¥åˆ° Agent æç¤ºè¯

**ä»»åŠ¡**:
- [ ] å®ç° `WorkingMemoryInjector` - æ³¨å…¥å½“å‰å·¥ä½œè®°å¿†
- [ ] å®ç° `InvariantInjector` - æ³¨å…¥ Gold Memory çº¦æŸ
- [ ] å®ç° `TaskLineageInjector` - æ³¨å…¥ä»»åŠ¡è°±ç³»ä¸Šä¸‹æ–‡
- [ ] å¢å¼º `PromptBuilder` æ”¯æŒå¤šå±‚ä¸Šä¸‹æ–‡æ³¨å…¥

**æ–‡ä»¶**:
```
crates/core/src/ai_agent/
â”œâ”€â”€ injectors/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ working_memory.rs   # Working Memory æ³¨å…¥
â”‚   â”œâ”€â”€ invariant.rs         # Invariant æ³¨å…¥
â”‚   â””â”€â”€ lineage.rs           # Task Lineage æ³¨å…¥
```

### Phase 3: Agent REPL é›†æˆ (P7.3)

**ç›®æ ‡**: åœ¨ REPL ä¸­å¯ç”¨ Agent æ¨¡å¼

**ä»»åŠ¡**:
- [ ] å®ç° `ReplAgentMode` - REPL çš„ Agent äº¤äº’æ¨¡å¼
- [ ] å®ç° `/agent` å‘½ä»¤ - åˆ‡æ¢ Agent æ¨¡å¼
- [ ] å®ç°æµå¼å“åº”æ˜¾ç¤º
- [ ] å®ç°æƒé™ç¡®è®¤ UI

**äº¤äº’æµç¨‹**:
```
ndc> /agent on

[Agent Mode Enabled]
Current agent: build
Provider: openai (gpt-4o)

ndc> æ·»åŠ ç”¨æˆ·è®¤è¯åŠŸèƒ½

ğŸ¤– Thinking...

I'll help you add user authentication. Let me:
1. First explore the codebase to understand the structure
2. Find existing authentication patterns
3. Plan the implementation
4. Implement the feature

[æ‰§è¡Œ read/write/edit/tools...]

âœ… User authentication feature added successfully!

Running verification...
âœ… All tests passing!

ndc> /agent off
[Agent Mode Disabled]
```

### Phase 4: å¢å¼ºåé¦ˆç³»ç»Ÿ (P7.4)

**ç›®æ ‡**: å®ç° NDC ç‰¹æœ‰çš„å¼ºå¤§åé¦ˆå¾ªç¯

**ä»»åŠ¡**:
- [ ] å®ç° `TaskVerifier` ä¸å­˜å‚¨é›†æˆ
- [ ] å®ç°è´¨é‡é—¨ç¦è‡ªåŠ¨æ‰§è¡Œ
- [ ] å®ç°å¤±è´¥å½’å› åˆ†æ
- [ ] å®ç° Human Correction â†’ Invariant è‡ªåŠ¨æ›´æ–°

**éªŒè¯æµç¨‹**:
```
AI æäº¤å®Œæˆ
    â†“
TaskVerifier.verify()
    â”œâ”€ æ£€æŸ¥ Task.state == Completed
    â”œâ”€ æ£€æŸ¥æ‰€æœ‰ ExecutionStep.result.success
    â”œâ”€ è¿è¡Œ Quality Gates
    â””â”€ Git çŠ¶æ€æ£€æŸ¥ (å¦‚æœæœ‰å˜æ›´)
    â†“
VerificationResult
    â”œâ”€ Completed â†’ æˆåŠŸ
    â”œâ”€ Incomplete(reason) â†’ ç”Ÿæˆç»§ç»­æŒ‡ä»¤
    â””â”€ QualityGateFailed(reason) â†’ è¿è¡Œæµ‹è¯•å¹¶ç»§ç»­
    â†“
AI æ¥æ”¶åé¦ˆç»§ç»­æ‰§è¡Œ
```

### Phase 5: Agent é…ç½®ç³»ç»Ÿ (P7.5)

**ç›®æ ‡**: æ”¯æŒ OpenCode é£æ ¼çš„ Agent é…ç½®

**é…ç½®æ ¼å¼** (`.ndc/agents.yaml`):
```yaml
agents:
  # é»˜è®¤ Agent (å¯¹åº” OpenCode çš„ build)
  build:
    name: build
    description: NDC default agent with engineering capabilities
    mode: primary
    provider: openai
    model: gpt-4o
    temperature: 0.1
    permission:
      # åŸºç¡€æƒé™
      "*": "allow"
      # å±é™©æ“ä½œéœ€è¦ç¡®è®¤
      "file_write": "ask"
      "git_commit": "ask"
      # NDC ç‰¹å®šæƒé™
      "quality_gate_run": "allow"
      "invariant_update": "allow"
    options:
      enable_verification: true
      max_tool_calls: 50
      doom_loop_protection: true

  # ä»£ç æ¢ç´¢ Agent (å¯¹åº” OpenCode çš„ explore)
  explore:
    name: explore
    description: Fast codebase exploration agent
    mode: subagent
    provider: openai
    model: gpt-4o
    permission:
      "*": "deny"
      "read": "allow"
      "grep": "allow"
      "glob": "allow"
      "list": "allow"
    options:
      thoroughness: medium

  # è§„åˆ’ Agent (å¯¹åº” OpenCode çš„ plan)
  plan:
    name: plan
    description: Planning agent with task decomposition
    mode: primary
    permission:
      "plan_enter": "allow"
      "file_write": "deny"  # è§„åˆ’æ¨¡å¼ç¦æ­¢å†™æ–‡ä»¶
      "plan_exit": "allow"
    options:
      enable_decomposition: true
      use_working_memory: true
```

---

## äº”ã€æ–‡ä»¶ç»“æ„æ›´æ–°

```
crates/
â”œâ”€â”€ core/src/
â”‚   â”œâ”€â”€ ai_agent/
â”‚   â”‚   â”œâ”€â”€ mod.rs                   # AI Agent æ¨¡å— (å·²å®Œæˆ)
â”‚   â”‚   â”œâ”€â”€ orchestrator.rs           # Agent Orchestrator (å·²å®Œæˆ)
â”‚   â”‚   â”œâ”€â”€ session.rs                # Session Manager (å·²å®Œæˆ)
â”‚   â”‚   â”œâ”€â”€ verifier.rs               # Task Verifier (å·²å®Œæˆ)
â”‚   â”‚   â”œâ”€â”€ prompts.rs                # System Prompts (å·²å®Œæˆ)
â”‚   â”‚   â”œâ”€â”€ tool_executor.rs          # [æ–°å¢] Tool Executor å®ç°
â”‚   â”‚   â””â”€â”€ adapters/                 # [æ–°å¢] å·¥å…·é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ mcp_adapter.rs
â”‚   â”‚       â””â”€â”€ skill_adapter.rs
â”‚   â”‚   â””â”€â”€ injectors/               # [æ–°å¢] ä¸Šä¸‹æ–‡æ³¨å…¥å™¨
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ working_memory.rs
â”‚   â”‚       â”œâ”€â”€ invariant.rs
â”‚   â”‚       â””â”€â”€ lineage.rs
â”‚
â”œâ”€â”€ runtime/src/
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â””â”€â”€ ndc/                     # NDC Task Tools (å·²å®Œæˆ)
â”‚   â”‚   â”œâ”€â”€ mod.rs                    # [æ›´æ–°] æ³¨å†Œ NDC Tools
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ agent_integration.rs         # [æ–°å¢] Agent é›†æˆå±‚
â”‚
â””â”€â”€ interface/src/
    â”œâ”€â”€ repl.rs                      # [æ›´æ–°] é›†æˆ Agent æ¨¡å¼
    â””â”€â”€ agent_mode.rs                # [æ–°å¢] Agent REPL æ¨¡å¼
```

---

## å…­ã€å…³é”®è®¾è®¡å†³ç­–

### 6.1 å¤ç”¨ vs é‡å†™

| ç»„ä»¶ | å†³ç­– | ç†ç”± |
|------|------|------|
| Tool Registry | **å¤ç”¨** | å·²å®ç°å®Œå–„çš„å·¥å…·ç³»ç»Ÿ |
| Permission System | **å¤ç”¨** | å·²å®ç° allow/ask/deny |
| MCP Manager | **å¤ç”¨** | å·²å®ç°å®Œæ•´çš„ MCP æ”¯æŒ |
| Skills Registry | **å¤ç”¨** | å·²å®ç° SKILL.md è§£æå’Œæ‰§è¡Œ |
| Agent Orchestrator | **é‡å†™/å¢å¼º** | éœ€è¦ NDC ç‰¹å®šçš„åé¦ˆå¾ªç¯å’ŒéªŒè¯ |
| System Prompts | **é‡æ–°è®¾è®¡** | éœ€è¦æ³¨å…¥ NDC å·¥ç¨‹æ–¹æ³• |
| Working Memory | **é›†æˆæ³¨å…¥** | ä½œä¸ºä¸Šä¸‹æ–‡æ³¨å…¥åˆ° Agent |

### 6.2 OpenCode æ¨¡å¼ä½œä¸ºåŸºåº§

OpenCode æä¾›çš„æœ€ä½³å®è·µï¼š
1. **æµå¼å“åº”** - å®æ—¶å±•ç¤º AI æ€è€ƒè¿‡ç¨‹
2. **æƒé™ç¡®è®¤** - å±é™©æ“ä½œéœ€è¦äººå·¥ç¡®è®¤
3. **å·¥å…· Schema** - JSON Schema è®© AI ç²¾ç¡®ç†è§£å·¥å…·
4. **è¾“å‡ºæˆªæ–­** - å¤§è¾“å‡ºè‡ªåŠ¨å¤„ç†
5. **Doom Loop æ£€æµ‹** - é˜²æ­¢æ— é™å¾ªç¯
6. **åˆ†å±‚ Agent** - subagent/primary/all æ¨¡å¼

### 6.3 NDC å·¥ç¨‹å­¦å¢å¼º

NDC ç‹¬ç‰¹çš„å·¥ç¨‹èƒ½åŠ›ï¼š
1. **åé¦ˆå¾ªç¯éªŒè¯** - ç³»ç»ŸéªŒè¯ AI å·¥ä½œè´¨é‡
2. **Working Memory** - ç²¾ç®€ä¸Šä¸‹æ–‡ï¼Œå·¥ç¨‹ä¼˜å…ˆ
3. **Invariant Memory** - äººç±»çº æ­£ â†’ æ°¸ä¸é‡å¤çŠ¯é”™
4. **Task Lineage** - ä»»åŠ¡è°±ç³»ç»§æ‰¿
5. **Discovery Phase** - å½±å­æ¢æµ‹ï¼Œå…ˆ X å…‰å†åŠ¨æ‰‹
6. **Saga Pattern** - å¯å›æ»šçš„æ‰§è¡Œ
7. **Quality Gates** - è´¨é‡é—¨ç¦

---

## ä¸ƒã€å®æ–½ä¼˜å…ˆçº§

### ç«‹å³æ‰§è¡Œ (P7.1)

1. **å®ç° ToolExecutor trait** - æ¡¥æ¥ Agent å’Œç°æœ‰å·¥å…·ç³»ç»Ÿ
2. **MCP Tool Adapter** - MCP å·¥å…·è½¬æ¢ä¸º Agent å·¥å…·
3. **Skill Tool Adapter** - Skills è½¬æ¢ä¸º Agent å·¥å…·

### çŸ­æœŸ (P7.2-P7.3)

1. **Working Memory æ³¨å…¥** - å°†ä¸Šä¸‹æ–‡æ³¨å…¥åˆ° Agent æç¤ºè¯
2. **Agent REPL æ¨¡å¼** - REPL é›†æˆ Agent
3. **æµå¼å“åº”æ”¯æŒ** - å®æ—¶å±•ç¤º AI æ€è€ƒ

### ä¸­æœŸ (P7.4-P7.5)

1. **TaskVerifier é›†æˆå­˜å‚¨** - å®Œæ•´çš„éªŒè¯å¾ªç¯
2. **è´¨é‡é—¨ç¦è‡ªåŠ¨æ‰§è¡Œ**
3. **Agent é…ç½®ç³»ç»Ÿ** - .ndc/agents.yaml æ”¯æŒ

### é•¿æœŸ (P7.6+)

1. **çŸ¥è¯†åº“æ£€ç´¢é›†æˆ** - Phase 1 ç†è§£éœ€æ±‚å¢å¼º
2. **æ–‡æ¡£è‡ªåŠ¨æ›´æ–°** - Phase 8 æ–‡æ¡£ç”Ÿæˆ
3. **å¤š Agent åä½œ** - Planner â†’ Implementer â†’ Reviewer æµç¨‹

---

## å…«ã€æ€»ç»“

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **OpenCode æ¨¡å¼ä¸ºåŸºåº§**:
   - æµå¼å“åº”
   - æƒé™ç¡®è®¤
   - å·¥å…· Schema
   - è¾“å‡ºæˆªæ–­
   - Doom Loop æ£€æµ‹

2. **NDC å·¥ç¨‹å­¦å¢å¼º**:
   - åé¦ˆå¾ªç¯éªŒè¯
   - Working Memory æ³¨å…¥
   - Invariant Gold Memory
   - Task Lineage ç»§æ‰¿
   - Discovery Phase

3. **æœ€å¤§åŒ–å¤ç”¨**:
   - Tool Registry (P4)
   - MCP Integration (P5)
   - Skills System (P5)
   - Permission System (P4)

4. **æ— ç¼é›†æˆ**:
   - é€‚é…å™¨æ¨¡å¼æ¡¥æ¥ç°æœ‰ç³»ç»Ÿ
   - æ³¨å…¥å™¨æ¨¡å¼å¢å¼ºä¸Šä¸‹æ–‡
   - Agent Orchestrator åè°ƒæ‰€æœ‰ç»„ä»¶

### æŠ€æœ¯æ¶æ„æ€»ç»“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NDC AI Agent å®Œæ•´æ¶æ„                                 â”‚
â”‚                                                                             â”‚
â”‚  OpenCode åŸºåº§ + NDC å·¥ç¨‹å­¦ = æ›´å¼ºå¤§çš„å¼€å‘åŠ©æ‰‹                                  â”‚
â”‚                                                                             â”‚
â”‚  åŸºåº§ (æ¥è‡ª OpenCode):                                                         â”‚
â”‚  âœ“ æµå¼å“åº”å®æ—¶åé¦ˆ                                                          â”‚
â”‚  âœ“ æƒé™ç³»ç»Ÿä¿æŠ¤                                                              â”‚
â”‚  âœ“ å·¥å…· Schema ç²¾ç¡®ç†è§£                                                     â”‚
â”‚  âœ“ Doom Loop é˜²æŠ¤                                                           â”‚
â”‚                                                                             â”‚
â”‚  å¢å¼º (æ¥è‡ª NDC å·¥ç¨‹):                                                       â”‚
â”‚  âœ“ åé¦ˆå¾ªç¯éªŒè¯ - ç¡®ä¿ä»»åŠ¡çœŸæ­£å®Œæˆ                                         â”‚
â”‚  âœ“ Working Memory - ç²¾ç®€ä¸Šä¸‹æ–‡                                               â”‚
â”‚  âœ“ Invariant Memory - æ°¸ä¸é‡å¤çŠ¯é”™                                           â”‚
â”‚  âœ“ Task Lineage - è°±ç³»ç»§æ‰¿                                                   â”‚
â”‚  âœ“ Discovery Phase - å…ˆ X å…‰å†åŠ¨æ‰‹                                             â”‚
â”‚  âœ“ Quality Gates - è´¨é‡ä¿è¯                                                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-02-11
**çŠ¶æ€**: å¾…å®¡æ ¸æ‰¹å‡†
